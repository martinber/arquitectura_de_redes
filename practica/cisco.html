

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Cisco &mdash; documentación de Arquitectura de Redes - </title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Mikrotik" href="mikrotik.html" />
    <link rel="prev" title="Linux" href="linux.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Arquitectura de Redes
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../teoria/index.html">Teoría</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Práctica</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#comandos">Comandos</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="linux_basico.html">Linux básico</a></li>
<li class="toctree-l3"><a class="reference internal" href="linux.html">Linux</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Cisco</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basico">Básico</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nat">NAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#servidor-dhcp">Servidor DHCP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enlace-serial">Enlace serial</a></li>
<li class="toctree-l4"><a class="reference internal" href="#servidor-pppoe">Servidor PPPoE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-switch">VLAN (switch)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vlan-router">VLAN (router)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipv6">IPv6</a></li>
<li class="toctree-l4"><a class="reference internal" href="#to4">6to4</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rip">RIP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ospf">OSPF</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bgp">BGP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mpls">MPLS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mikrotik.html">Mikrotik</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#servidores">Servidores</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#varios">Varios</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Arquitectura de Redes</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Práctica</a> &raquo;</li>
        
      <li>Cisco</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/practica/cisco.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cisco">
<h1>Cisco<a class="headerlink" href="#cisco" title="Enlazar permanentemente con este título">¶</a></h1>
<ul class="simple">
<li>Se usa puerto de consola serial a 9600 baudios</li>
<li>Para ayuda ir poniendo <code class="docutils literal notranslate"><span class="pre">?</span></code>.</li>
<li>Para ir volviendo atrás poner <code class="docutils literal notranslate"><span class="pre">exit</span></code>.</li>
</ul>
<div class="section" id="basico">
<h2>Básico<a class="headerlink" href="#basico" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Pasar al modo privilegiado:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router&gt; enable
</pre></div>
</div>
<p>Mostrar cosas:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# show ip interface brief
router# show ipv6 interface brief
router# show ip interface f0/0
router# show ipv6 interface f0/0
router# show ip route
router# show running-config
</pre></div>
</div>
<p>Configurar IP:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# configure terminal
router(config)# interface FastEthernet0/0
router(config-if)# ip address 192.168.1.1 255.255.255.0
</pre></div>
</div>
<p>Configurar IP secundaria:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-if)# ip address 192.168.2.1 255.255.255.0 secondary
</pre></div>
</div>
<p>Habilitar interfaz:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-if)# no shutdown
router(config-if)# exit
</pre></div>
</div>
<p>Configurar rutas:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ip route 0.0.0.0 0.0.0.0 {IP gateway}
router(config)# ip route {IP destino} {mascara destino} {IP gateway}

router(config)# ipv6 route ::/0 {IP gateway}
router(config)# ipv6 route {IP destino}/{mascara destino} {IP gateway}
</pre></div>
</div>
<p>Crear loopback y dar IP:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(config)# interface loopback 0
(config-if)# ip address 7.0.0.4 255.0.0.0
</pre></div>
</div>
<p>Para guardar la configuracion de inicio:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# copy running-config startup-config
</pre></div>
</div>
<p>Para borrar la configuración de inicio encontré tres formas, en GNS3 no anda
ninguna:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# erase startup-config
router# erase nvram:
router# write erase
</pre></div>
</div>
<p>Para reiniciar en GNS3 usar el botón de «Stop», en un dispositivo físico:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# reload
</pre></div>
</div>
<p>Para reiniciar la configuración en GNS3, agregar un nuevo router, click derecho,
exportar su configuración, hacer click derecho en el router a reiniciar, imporar
configuración.</p>
</div>
<div class="section" id="nat">
<h2>NAT<a class="headerlink" href="#nat" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Configurar cual es la interna y cual externa:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# configure terminal
router(config)# interface FastEthernet0/0
router(config-if)# ip nat inside
router(config-if)# exit
router(config)# interface FastEthernet0/1
router(config-if)# ip nat outside
router(config-if)# exit
</pre></div>
</div>
<p>Configurar lista de acceso con un numero mayor a 100 protocolo IP, para
cualquier origen y cualquier destino:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# access-list 101 permit ip any any
</pre></div>
</div>
<p>Configurar pool de rango de IPs a usar para nateo (las de afuera, normalmente
una sola):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ip nat pool {nombre} {IP inicial} {IP final} netmask {mascara}
</pre></div>
</div>
<p>Terminar:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ip nat inside source list 101 pool {nombre pool} overload
</pre></div>
</div>
<p>Mostrar info:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# exit
router# show ip nat translations
</pre></div>
</div>
</div>
<div class="section" id="servidor-dhcp">
<h2>Servidor DHCP<a class="headerlink" href="#servidor-dhcp" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Primero configurar IPs y rutas.</p>
<p>Dar de alta dhcp, con «no» se da de baja:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# configure terminal
router(config)# service dhcp
</pre></div>
</div>
<p>Crear pool de IPs, excluir IPs de la red a no asignar y dar red a utilizar:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ip dhcp excluded-address {IP minima} {IP maxima}
router(config)# ip dhcp pool {nombre}
</pre></div>
</div>
<p>Configurar parametros, la red es el rango de IPs a dar:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(dhcp-config)# network {Numero red} {mascara}
router(dhcp-config)# domain-name {IP DNS}
router(dhcp-config)# default-router {IP gateway}
router(dhcp-config)# lease {dias}
</pre></div>
</div>
<p>Configurar tiempo de comprobacion de si la IP esta asignada:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(dhcp-config)# exit
router(config)# ip dhcp timeout {milisegundos}
</pre></div>
</div>
<p>Comprobacion de configuracion:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# exit
router# exit

router# show ip dhcp binding
router# show ip dhcp conflict
router# show ip dhcp server statistics
</pre></div>
</div>
<p>Mostrar debug:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# debug ip dhcp server events|packet|linkage
</pre></div>
</div>
</div>
<div class="section" id="enlace-serial">
<h2>Enlace serial<a class="headerlink" href="#enlace-serial" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li>DCE: (Hembra), Configura velocidad.</li>
<li>DTE: (Macho), Recibe velocidad.</li>
</ul>
<p>Para ver interfaces seriales en Cisco (muestra si es DCE o DTE):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# show controllers Serial0/0/0
</pre></div>
</div>
<p>Para configurar DCE:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# configure terminal
router(config)# interface serial 0/0/0
router(config-if)# clock rate 125000
router(config-if)# ip address {ip}
</pre></div>
</div>
<p>Para configurar DTE en Cisco no hay nada especial. Directamente te pones IP.</p>
</div>
<div class="section" id="servidor-pppoe">
<h2>Servidor PPPoE<a class="headerlink" href="#servidor-pppoe" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Configurar salida al exterior:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# configure terminal
router(config)# interface fastEthernet 0/0
router(config-if)# ip address {IP salida}
router(config-if)# no shutdown
router(config-if)# exit
router(config)# ip route 0.0.0.0 0.0.0.0 {gateway}
</pre></div>
</div>
<p>PPPoE:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# configure terminal
router(config)# username {usuario cliente} password {pass cliente}
router(config)# bba-group pppoe global
router(config)# virtual-template 20
</pre></div>
</div>
<p>Configurar interfaz:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface fastEthernet 0/1
router(config-if)# pppoe enable
</pre></div>
</div>
<p>Configurar PPPoE:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface virtual-template 20
router(config-if)# mtu 1492
router(config-if)# ppp mtu adaptive
router(config-if)# ip unnumbered fastEthernet 0/1
router(config-if)# peer default ip address pool pppoepool
router(config-if)# ppp authentication {no me acuerdo si era &quot;pap&quot; o &quot;chap&quot;}
router(config-if)# ppp chap hostname {nombre servidor}
router(config-if)# ppp chap password 0 {pass servidor}
router(config-if)# exit
router(config)# ip local pool pppoepool 10.10.10.1 10.10.10.200
</pre></div>
</div>
<p>Falta hacer NAT para que pueda salir afuera.</p>
</div>
<div class="section" id="vlan-switch">
<h2>VLAN (switch)<a class="headerlink" href="#vlan-switch" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Mostrar VLANs activas:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>switch# show vlan
</pre></div>
</div>
<p>Agregar VLAN:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>switch(config)# vlan 2
switch(config-vlan)# name {nombre_vlan}
switch(config-vlan)# exit
</pre></div>
</div>
<p>Agregar interfaces a una VLAN, especificando rango:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>switch(config)# interface range fastEthernet 0/{x} - {y}
switch(config-if-range)# switchport mode access
switch(config-if-range)# switchport access vlan 2
</pre></div>
</div>
<p>Agregar trunk, también se puede especificar un rango pero este es ejemplo de la
configuración de solo una:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>switch(config)# interface fastEthernet 0/{x}
switch(config-if)# encapsulation dot1q
switch(config-if)# switchport mode trunk
switch(config-if)# switchport trunk native vlan 1
switch(config-if)# switchport trunk allowed vlan all
switch(config-if)# switchport trunk allowed vlan add 2
switch(config-if)# switchport trunk allowed vlan remove 3
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Por hacer</p>
<p class="last">VLAN Trunking protocol (VTP) es un protocolo propietario de cisco que tiene 3
modos: Server,Client, y Transparent. A mi no me dejaba configurar vlans porque
estaba en modo cliente, por lo tanto lo tuve que cambiar el switch a modo
server.
__SW_P__(config)#vtp  mode server
«At least one server is required in a VTP domain to propagate VLAN Information
within the VTP domain. We can create, add, or delete VLANs of a VTP domain in a
Switch which is in VTP servver mode and change VLAN Information  in a VTP
server»
VTP cliente necesita un switch servidor que le informe sobre los cambios o
configuraciones de las VLANs y escucha avisos de otros switches. NO podemos
crear,modificar, o eliminar VLANs en un switch VTP cliente.
VTP transparente no participa en un dominio VTP, pero pueden recibir mensajes
protocolares y switchearlos.</p>
</div>
</div>
<div class="section" id="vlan-router">
<h2>VLAN (router)<a class="headerlink" href="#vlan-router" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Routear con Cisco en trunk:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface FastEthernet0/0

router(config-if)# sub-interface FastEthernet0/0.2
router(config-if)# encapsulation dot1q 2
router(config-if)# ip address 192.168.1.1 255.255.255.0

router(config-if)# sub-interface FastEthernet0/0.3
router(config-if)# encapsulation dot1q 3
router(config-if)# ip address 192.168.2.1 255.255.255.0
</pre></div>
</div>
</div>
<div class="section" id="ipv6">
<h2>IPv6<a class="headerlink" href="#ipv6" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Habilitar ruteo IPv6:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ipv6 unicast-routing
</pre></div>
</div>
<p>Habilitar dirección link-local bajo una interfaz:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface {interfaz}
router(config-if)# ipv6 enable
</pre></div>
</div>
<p>Habilitar RA en una interfaz y configurar el intervalo en segundos:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface {interfaz}
router(config-if)# no ipv6 nd suppress-ra
router(config-if)# ipv6 nd ra-interval {intervalo}
</pre></div>
</div>
<p>Me pasó a veces que RA viene activado en las interfaces por defecto, es posible
que si uno no quiere RA, haya que dehabilitarlo manualmente:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface {interfaz}
router(config-if)# ipv6 nd suppress-ra
</pre></div>
</div>
<p>En routers nuevos puede que los comandos sean:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface {interfaz}
router(config-if)# no ipv6 nd ra suppress
router(config-if)# ipv6 nd ra interval {intervalo}
</pre></div>
</div>
</div>
<div class="section" id="to4">
<h2>6to4<a class="headerlink" href="#to4" title="Enlazar permanentemente con este título">¶</a></h2>
<img alt="../_images/6to4.svg" src="../_images/6to4.svg" /><p>Activar ruteo IPv6:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ipv6 unicast-routing
</pre></div>
</div>
<p>Dar IPv4 a la interfaz WAN:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface FastEthernet {if_wan}
router(config-if)# ip address {ipv4_if_wan} {ipv4_mask_if_wan}
router(config-if)# no shutdown
router(config-if)# exit
</pre></div>
</div>
<p>Crear tunel y ponerle una IPv6 que está en la red <code class="docutils literal notranslate"><span class="pre">2002:{ipv4}:0000::/64</span></code>,
generalmente la <code class="docutils literal notranslate"><span class="pre">::1</span></code> e indicar que sale por la <code class="docutils literal notranslate"><span class="pre">{if_wan}</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface Tunnel2002
router(config-if)# no ip address
router(config-if)# no ip redirects
router(config-if)# no shutdown
router(config-if)# ipv6 address {ipv6_if_wan}/128
router(config-if)# tunnel source FastEthernet {if_wan}
router(config-if)# tunnel mode ipv6ip 6to4
router(config-if)# exit
</pre></div>
</div>
<p>Configurar la interfaz con IPv6 que da a la LAN, tiene que estar en una subred,
generalmente también es la <code class="docutils literal notranslate"><span class="pre">::1</span></code>, en tal caso es
<code class="docutils literal notranslate"><span class="pre">2002:{ipv4}:{subred}::1/64</span></code>. También habilitar RA:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface FastEthernet {if_lan}
router(config-if)# ipv6 address {ipv6_if_lan} {ipv6_mask_if_lan}
router(config-if)# no shutdown
router(config-if)# no ipv6 nd suppress-ra
</pre></div>
</div>
<p>Configurar las rutas, la primera es una ruta IPv4 común para que se llegue a
destino por IPv4. La segunda no se bien por qué está. La tercera es el gateway
IPv6, en el caso en el que hayan varios túneles hacia varias redes IPv6 habría
que separar las rutas en vez de tener una que vaya a <code class="docutils literal notranslate"><span class="pre">::/0</span></code>. Pero en el caso
más simple es:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ip route 0.0.0.0 0.0.0.0 {ipv4_if_gw}
router(config)# ipv6 route 2002::/16 Tunnel2002
router(config)# ipv6 route ::/0 {ipv6_if_wan_destino}
</pre></div>
</div>
</div>
<div class="section" id="rip">
<h2>RIP<a class="headerlink" href="#rip" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="ripv2">
<h3>RIPv2<a class="headerlink" href="#ripv2" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Hay que decirle que version usar.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)#router rip
router(config-router)#version 2
</pre></div>
</div>
<p>Desactivar la sumarización de redes, por lo tanto al usar el comando <code class="docutils literal notranslate"><span class="pre">network</span></code>
se publican las subredes que pertenezcan a esa red en lugar de la red completa
como una sola:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-router)#no auto-summary
</pre></div>
</div>
<p>Agregar redes en donde trabajar. De paso publica esas redes, como no pide
máscara se fija en la clase de la red para determinar la máscara, sumarizando
las redes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-router)#network {red}
</pre></div>
</div>
<p>Pasivar una interfaz:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>R6(config-router)#passive-interface {interfaz}
</pre></div>
</div>
<p>Distribuir más redes, usar metricas menores a 15:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-router)#redistribute static
router(config-router)#redistribute static metric {metrica}
</pre></div>
</div>
<p>Redistribuir EBGP si es necesario, usar metricas menores a 15:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# router rip
router(config-route)# redistribute bgp {numero_as} metric {metrica}
</pre></div>
</div>
<p>Redistribuir IBGP si es necesario, usar metricas menores a 15:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# router rip
router(config-route)# redistribute bgp {numero_as} metric {metrica}
router(config-route)# exit
router(config)# router bgp {numero_as}
router(config-route)# bgp redistribute-internal
</pre></div>
</div>
</div>
<div class="section" id="ripng">
<h3>RIPng<a class="headerlink" href="#ripng" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Primero dar IPv6 estáticas a cada interfaz y borrar las rutas si es que hay.</p>
<p>Después habilitar RIP en las interfaces que uno quiera, asignándole un nombre
cualquiera al proceso:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface {interfaz}
router(config-if)# ipv6 rip {nombre_proceso} enable
router(config-if)# exit
router(config)# ipv6 router rip {nombre_proceso}
router(config-if)# redistribute connected
</pre></div>
</div>
</div>
</div>
<div class="section" id="ospf">
<h2>OSPF<a class="headerlink" href="#ospf" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="ospfv2">
<h3>OSPFv2<a class="headerlink" href="#ospfv2" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Crear loopback:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface loopback 0
router(config-if)# ip address {ip_loopback} {mascara}
</pre></div>
</div>
<p>Crear un proceso OSPF, por ejemplo poner el número <code class="docutils literal notranslate"><span class="pre">100</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# router ospf {id_proceso}
</pre></div>
</div>
<p>Agregar redes en donde trabajar. De paso publica esas redes, con la máscara
dada. La mascara debe ser invertida, por ejemplo <code class="docutils literal notranslate"><span class="pre">255.255.255.240</span></code> se vuelve
<code class="docutils literal notranslate"><span class="pre">0.0.0.15</span></code>, si se suman queda 255 en cada octeto:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-route)# network {red} {mascara_invertida} area 1
</pre></div>
</div>
<p>Mascara invertida: 0.255.255.255 publica la 10.X.X.X.</p>
<p>Pasivar interfaces:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-route)# passive-interface {interfaz}
router(config-route)# passive-interface loopback0
</pre></div>
</div>
<p>Redistribuir EBGP si es necesario:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# router ospf {proceso}
router(config-route)# redistribute bgp {numero_as} subnets
</pre></div>
</div>
<p>Redistribuir IBGP si es necesario:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# router ospf {proceso}
router(config-route)# redistribute bgp {numero_as} subnets
router(config-route)# exit
router(config)# router bgp {numero_as}
router(config-route)# bgp redistribute-internal
</pre></div>
</div>
</div>
<div class="section" id="ospfv3">
<h3>OSPFv3<a class="headerlink" href="#ospfv3" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Primero se debe asignar una IPv4 al loopback, esta IP es usada por OSPF para
identificar a este router:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface loopback 0
router(config-if)# ip address {ipv4_loopback} {mascara}
router(config-if)# exit
</pre></div>
</div>
<p>Después se debe entrar a una interfaz de WAN y activar OSPF, se le debe asignar
un ID de proceso cualquiera mientras que sea un número, yo uso <code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface {interfaz}
router(config-if)# ipv6 ospf {id_proceso} area 0
</pre></div>
</div>
<p>Para indicar qué rutas se deben publicar:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-if)# ipv6 router ospf {id_proceso}
router(config-rtr)# redistribute static
router(config-rtr)# redistribute connected
router(config-rtr)# exit
</pre></div>
</div>
<p>Si se quieren agregar más interfaces WAN se puede compartir el ID del proceso,
no es necesario indicar las rutas a distribuir de nuevo:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# interface FastEthernet {interfaz}
router(config-if)# ipv6 ospf {id_proceso} area 0
</pre></div>
</div>
</div>
</div>
<div class="section" id="bgp">
<h2>BGP<a class="headerlink" href="#bgp" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Solamente hay un proceso, hay que darle el numero de AS:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# router bgp {numero_as}
</pre></div>
</div>
<p>Dar redes a anunciar, a diferencia de otros protocolos esto no indica las
interfaces que corren el protocolo, solamente las redes a anunciar:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-router)# network {red} mask {mascara}
</pre></div>
</div>
<p>Agregar vecino peer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-router)# neighbor {ip_destino} remote-as {as_destino}
</pre></div>
</div>
<p>Agregar peer estableciendo dirección de loopback de destino por si una de sus
interfaces se cae, normalmente se hace en IBGP:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-router)# neighbor {ip_loopback_destino} remote-as {as_destino}
</pre></div>
</div>
<p>Originar tráfico hacia peer desde mi propio loopback, en caso en que este router
tenga varias interfaces de salida hacia el peer. Si se cae una de las
interfaces, la comunicación comienza a originarse desde otra interfaz, el
destino verá que la IP de origen cambió y rechazará la conexión:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config-router)# neighbor {ip_loopback_destino} update-source loopback0
</pre></div>
</div>
<p>Publicar una ruta sumarizada que engloba a todas las redes dentro del AS, no se
pueden publicar rutas que no están en la tabla de ruteo el <code class="docutils literal notranslate"><span class="pre">null0</span></code> asegura que
si llega un paquete y no hay una ruta más específica el paquete se descarta.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ip route {red} {mascara} null0 250

router(config)# router bgp {numero_as}
router(config)# network {red} mask {mascara}
</pre></div>
</div>
<p>Configurar para que un peer reciba solamente la ruta por defecto, esto se podría
en un AS de tránsito para darle servicio a un AS que no es de tránsito:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router(config)# ip route 0.0.0.0 0.0.0.0 null0 250
router(config)# ip prefix-list DEFAULT permit 0.0.0.0/0
router(config)# route-map DEFAULT permit 10
router(config-route-map)# match ip address prefix-list DEFAULT
router(config-route-map)# exit

router(config)# router bgp {numero_as}
router(config-router)# neighbor {ip_destino} route-map DEFAULT out
router(config-router)# neighbor {ip_destino} default-originate
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p>Supongo que ese último bloque de comandos se puede resumir, el último comando
propaga la ruta por defecto a un peer en particular, el problema es que
cuando lo probé el peer recibía todas las rutas BGP más la por defecto.</p>
<p class="last">Todos los comandos anteriores lo que hacen es algo así como un filtro de
rutas para el peer, al cual se le daría solamente la ruta por defecto. El
problema que tuve es que cuando lo probé no propagaba nada, entonces agregué
el último comando que propaga la ruta por defecto y quedó como me gustaría.</p>
</div>
<p>Ver estado de sesiones BGP:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# show ip bgp summary
</pre></div>
</div>
<p>Ver tabla de enrutamiento BGP:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# show ip bgp
</pre></div>
</div>
<p>Ver vecinos y tipo y cantidad de mensajes intercambiados:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>router# show ip bgp neighbors
</pre></div>
</div>
</div>
<div class="section" id="mpls">
<h2>MPLS<a class="headerlink" href="#mpls" title="Enlazar permanentemente con este título">¶</a></h2>
<p>No hacenos la implementación, pero pongo algunos comandos que dan información.</p>
<p>Ver las interfaces sobre las que funciona MPLS-LDP:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>show mpls interfaces
</pre></div>
</div>
<p>Muestra los parámetros que está usando el protocolo en este equipo:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>show mpls ldp parameters
</pre></div>
</div>
<p>Mostrar los vecinos MPLS:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>show mpls ldp neighbor
</pre></div>
</div>
<p>Mostrar la tabla de etiquetas:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>show mpls ldp binding
</pre></div>
</div>
<p>Mostrar la tabla de forwarding:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>show mpls forwarding-table
</pre></div>
</div>
<p>No sé que hace este:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>show mpls ip binding
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mikrotik.html" class="btn btn-neutral float-right" title="Mikrotik" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="linux.html" class="btn btn-neutral" title="Linux" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Martín Bernardi

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>