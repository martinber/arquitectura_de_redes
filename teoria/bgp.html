

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>BGP &mdash; documentación de Arquitectura de Redes - </title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Índice"
              href="../genindex.html"/>
        <link rel="search" title="Búsqueda" href="../search.html"/>
    <link rel="top" title="documentación de Arquitectura de Redes - " href="../index.html"/>
        <link rel="up" title="Teoría" href="index.html"/>
        <link rel="next" title="MPLS" href="mpls.html"/>
        <link rel="prev" title="IGRP" href="igrp.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Arquitectura de Redes
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Teoría</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#principal">Principal</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#wan-y-ruteo">WAN y ruteo</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="hdlc.html">HDLC</a></li>
<li class="toctree-l3"><a class="reference internal" href="ppp.html">PPP</a></li>
<li class="toctree-l3"><a class="reference internal" href="pppoe.html">PPPoE</a></li>
<li class="toctree-l3"><a class="reference internal" href="rip.html">RIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="ospf.html">OSPF</a></li>
<li class="toctree-l3"><a class="reference internal" href="igrp.html">IGRP</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">BGP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#formas-de-aceptar-rutas">Formas de aceptar rutas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sincronizacion">Sincronización</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tipos-de-mensajes">Tipos de mensajes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mi-escenario-en-gns3">Mi escenario en GNS3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#links">Links</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mpls.html">MPLS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#capa-aplicacion-y-otros">Capa aplicación y otros</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../practica/index.html">Práctica</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Arquitectura de Redes</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Teoría</a> &raquo;</li>
        
      <li>BGP</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/teoria/bgp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bgp">
<h1>BGP<a class="headerlink" href="#bgp" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Border Gateway Protocol.</p>
<ul class="simple">
<li>Es el único protocolo de ruteo EGP.</li>
<li>Actualmente se utiliza la versión 4.</li>
<li>Usa un algoritmo de vector distancia modificado.</li>
<li>EBGP por defecto tiene TTL de uno, pero IBGP está diseñado para ser ruteado
por un IGP.</li>
<li>Los vecinos se llaman peers.</li>
</ul>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Por hacer</p>
<ul class="last simple">
<li>Usa UDP para algunas cosas y TCP para otras</li>
</ul>
</div>
<ul class="simple">
<li>Cada router tiene un ID de 24 bits, por defecto es la IP de una interfaz de
loopback. De lo contrario se usa una IP de alguna interfaz pero puede traer
problemas si esa interfaz se cae.</li>
<li>Los ID de router deben ser únicos dentro del sistema autónomo.</li>
<li>Para evitar bucles descarta las rutas que pasan por él mismo.</li>
<li>Permite introducir restricciones o reglas políticas.</li>
<li>Los sistemas autónomos pueden ser:<ul>
<li>Stub: Sólo tienen una conexión.</li>
<li>De tránsito: Tienen varias conexiones.</li>
<li>Multihomed: Tienen varias conexiones pero rechaza el tráfico de tránsito,
esto se logra al no anunciar las redes de los demás peers.</li>
</ul>
</li>
</ul>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Por hacer</p>
<p class="last">Buscar atributos de rutas, como AS-Path.</p>
</div>
<div class="section" id="formas-de-aceptar-rutas">
<h2>Formas de aceptar rutas<a class="headerlink" href="#formas-de-aceptar-rutas" title="Enlazar permanentemente con este título">¶</a></h2>
<ol class="arabic">
<li><p class="first">Aceptar sólo rutas por defecto desde todos los ISP. En este caso los consumos
de recursos serán muy bajos y la selección de rutas se hará utilizando el
router BGP más cercano.</p>
<p>Hay varias formas:</p>
<ul class="simple">
<li>Hay que pedirle al ISP que te envíe sólamente la ruta por defecto.</li>
<li>Podés filtrar las rutas que recibís y poner una ruta por defecto hacia el
ISP.</li>
<li>Creo que había otra más que no me acuerdo.</li>
</ul>
</li>
<li><p class="first">Aceptar algunas rutas más las rutas por defecto desde los ISP. En este caso
el consumo de recursos de memoria y CPU será medio. El router seleccionará la
ruta específica y si no la conoce lo hará a través del router BGP más
cercano.</p>
</li>
<li><p class="first">Aceptar todas las rutas desde todos los ISP, en este caso el consumo de
recursos es alto pero en contra posición siempre se elegirá la ruta más
directa.</p>
</li>
</ol>
</div>
<div class="section" id="sincronizacion">
<h2>Sincronización<a class="headerlink" href="#sincronizacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Se aplica a AS de tránsito que tienen algún IGP dentro. Cuando se activa la
sincronización, un AS de tránsito no anuncia por EBGP que puede alcanzar
determinadas rutas hasta que se asegura de que su IGP haya convergido.</p>
<p>Suponiendo que hay un AS de tránsito 200 conectado a dos AS: 100 y 300. Si la
sincronización no está habilitada puede pasar que el AS de tránsito 200
anuncie al AS 300 que posee una ruta hacia al AS 100. Esto está bien siempre y
cuando el IGP dentro del AS de tránsito 100 haya logrado la convergencia, de lo
contrario cuando llegue un paquete desde el AS 300 hacia el AS 100 puede ocurrir
que algún router dentro del AS de tránsito 200 que corre EBGP pero no IGP no
conozca todavía esa ruta.</p>
<p>Al activar la sincronización uno se asegura que no se anuncian por EBGP rutas
que temporalmente no son alcanzables. Si se deshabilita se logra la convergencia
de EBGP más rápidamente a expensas de perder paquetes al principio.</p>
</div>
<div class="section" id="tipos-de-mensajes">
<h2>Tipos de mensajes<a class="headerlink" href="#tipos-de-mensajes" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li>Open: Una vez que se estableció una conexión TCP se establece una sesión BGP
mediante mensajes Open que informan de parámetros básicos como los IDs,
números de AS, etc.</li>
<li>Update: Contiene información sobre los prefijos publicados.</li>
<li>Keepalive: Se usan para indicar que el host sigue activo.</li>
<li>Notification: Indica que hubo un error, luego de este mensaje se cierra la
conexión TCP.</li>
<li>Route refresh: Es opcional, se usa para solicitar o enviar actualizaciones de
rutas.</li>
</ul>
</div>
<div class="section" id="mi-escenario-en-gns3">
<h2>Mi escenario en GNS3<a class="headerlink" href="#mi-escenario-en-gns3" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Hice un escenario con un AS de tránsito conectado a dos AS de punta. El AS 200
(de tránsito) tiene OSPF y el AS 300 tiene RIP.</p>
<p>La idea era que los routers del AS de tránsito tengan todas las rutas para poder
elegir los caminos, pero que los AS de punta reciban por BGP sólo una ruta por
defecto porque no necesitan más que eso.</p>
<img alt="../_images/gns3_bgp.png" src="../_images/gns3_bgp.png" />
<div class="section" id="rutas">
<h3>Rutas<a class="headerlink" href="#rutas" title="Enlazar permanentemente con este título">¶</a></h3>
<p>R1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>     1.0.0.0/8 is variably subnetted, 3 subnets, 3 masks
C       1.0.1.0/26 is directly connected, FastEthernet0/0
S       1.0.1.0/24 is directly connected, Null0
C       1.0.1.192/32 is directly connected, Loopback0
     2.0.0.0/30 is subnetted, 1 subnets
C       2.0.0.0 is directly connected, Serial0/0
B*   0.0.0.0/0 [20/0] via 2.0.0.2, 00:27:25
</pre></div>
</div>
<p>R2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>     1.0.0.0/8 is variably subnetted, 10 subnets, 4 masks
B       1.0.1.0/24 [20/0] via 2.0.0.1, 00:51:38
O E2    1.0.3.0/24 [110/1] via 1.0.2.134, 00:10:26, FastEthernet0/1
C       1.0.2.0/26 is directly connected, FastEthernet0/0
O       1.0.2.64/26 [110/30] via 1.0.2.134, 00:10:26, FastEthernet0/1
C       1.0.2.128/30 is directly connected, Serial0/1
C       1.0.2.132/30 is directly connected, FastEthernet0/1
O       1.0.2.136/30 [110/20] via 1.0.2.134, 00:10:26, FastEthernet0/1
O       1.0.2.194/32 [110/21] via 1.0.2.134, 00:10:27, FastEthernet0/1
O       1.0.2.193/32 [110/20] via 1.0.2.134, 00:10:27, FastEthernet0/1
C       1.0.2.192/32 is directly connected, Loopback0
     2.0.0.0/30 is subnetted, 2 subnets
C       2.0.0.0 is directly connected, Serial0/0
O       2.0.0.4 [110/84] via 1.0.2.134, 00:10:31, FastEthernet0/1
S*   0.0.0.0/0 is directly connected, Null0
</pre></div>
</div>
<p>R3:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> #      DST-ADDRESS        PREF-SRC        GATEWAY            DISTANCE
 0 ADo  1.0.1.0/24                         1.0.2.133               110
 1 ADo  1.0.2.0/26                         1.0.2.133               110
 2 ADo  1.0.2.64/26                        1.0.2.138               110
 3 ADo  1.0.2.128/30                       1.0.2.138               110
                                           1.0.2.133
 4 ADC  1.0.2.132/30       1.0.2.134       ether1                    0
 5 ADC  1.0.2.136/30       1.0.2.137       ether2                    0
 6 ADo  1.0.2.192/32                       1.0.2.133               110
 7 ADC  1.0.2.193/32       1.0.2.193       loopback0                 0
 8 ADo  1.0.2.194/32                       1.0.2.138               110
 9 ADo  1.0.3.0/24                         1.0.2.138               110
10 ADo  2.0.0.0/30                         1.0.2.133               110
11 ADo  2.0.0.4/30                         1.0.2.138               110
</pre></div>
</div>
<p>R4:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>     1.0.0.0/8 is variably subnetted, 10 subnets, 4 masks
O E2    1.0.1.0/24 [110/1] via 1.0.2.137, 00:11:25, FastEthernet0/1
B       1.0.3.0/24 [20/0] via 2.0.0.6, 00:49:10
O       1.0.2.0/26 [110/30] via 1.0.2.137, 00:11:25, FastEthernet0/1
C       1.0.2.64/26 is directly connected, FastEthernet0/0
C       1.0.2.128/30 is directly connected, Serial0/1
O       1.0.2.132/30 [110/20] via 1.0.2.137, 00:11:25, FastEthernet0/1
C       1.0.2.136/30 is directly connected, FastEthernet0/1
C       1.0.2.194/32 is directly connected, Loopback0
O       1.0.2.193/32 [110/20] via 1.0.2.137, 00:11:26, FastEthernet0/1
O       1.0.2.192/32 [110/21] via 1.0.2.137, 00:11:26, FastEthernet0/1
     2.0.0.0/30 is subnetted, 2 subnets
O       2.0.0.0 [110/84] via 1.0.2.137, 00:11:26, FastEthernet0/1
C       2.0.0.4 is directly connected, Serial0/0
S*   0.0.0.0/0 is directly connected, Null0
</pre></div>
</div>
<p>R5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>     1.0.0.0/8 is variably subnetted, 5 subnets, 4 masks
R       1.0.3.0/26 [120/1] via 1.0.3.130, 00:00:07, FastEthernet0/0
S       1.0.3.0/24 is directly connected, Null0
C       1.0.3.128/30 is directly connected, FastEthernet0/0
C       1.0.3.192/32 is directly connected, Loopback0
R       1.0.3.193/32 [120/1] via 1.0.3.130, 00:00:07, FastEthernet0/0
     2.0.0.0/30 is subnetted, 1 subnets
C       2.0.0.4 is directly connected, Serial0/0
B*   0.0.0.0/0 [20/0] via 2.0.0.5, 00:49:46
</pre></div>
</div>
<p>R6:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#      DST-ADDRESS        PREF-SRC        GATEWAY            DISTANCE
0 ADr  0.0.0.0/0                          1.0.3.129               120
1 ADr  1.0.3.0/24                         1.0.3.129               120
2 ADC  1.0.3.0/26         1.0.3.1         ether2                    0
3 ADC  1.0.3.128/30       1.0.3.130       ether1                    0
4 ADr  1.0.3.192/32                       1.0.3.129               120
5 ADC  1.0.3.193/32       1.0.3.193       loopback0                 0
6 ADr  2.0.0.4/30                         1.0.3.129               120
</pre></div>
</div>
</div>
<div class="section" id="configuraciones">
<h3>Configuraciones<a class="headerlink" href="#configuraciones" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Solamente pongo las de los Ciscos porque son las que más trabajo hacen.</p>
<p>R1:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>interface Loopback0
 ip address 1.0.1.192 255.255.255.255
!
interface FastEthernet0/0
 ip address 1.0.1.1 255.255.255.192
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 2.0.0.1 255.255.255.252
 clock rate 2000000
!
router bgp 100
 no synchronization
 bgp log-neighbor-changes
 network 1.0.1.0 mask 255.255.255.0
 neighbor 2.0.0.2 remote-as 200
 no auto-summary
!
ip route 1.0.1.0 255.255.255.0 Null0 250
</pre></div>
</div>
<p>R2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>interface Loopback0
 ip address 1.0.2.192 255.255.255.255
!
interface FastEthernet0/0
 ip address 1.0.2.1 255.255.255.192
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 2.0.0.2 255.255.255.252
 clock rate 2000000
!
interface FastEthernet0/1
 ip address 1.0.2.133 255.255.255.252
 duplex auto
 speed auto
!
interface Serial0/1
 ip address 1.0.2.129 255.255.255.252
 clock rate 2000000
!
router ospf 10
 log-adjacency-changes
 redistribute bgp 200 subnets
 passive-interface FastEthernet0/0
 passive-interface Serial0/0
 passive-interface Loopback0
 network 1.0.2.0 0.0.0.63 area 0
 network 1.0.2.128 0.0.0.3 area 0
 network 1.0.2.132 0.0.0.3 area 0
 network 1.0.2.192 0.0.0.0 area 0
 network 2.0.0.0 0.0.0.3 area 0
!
router bgp 200
 no synchronization
 bgp log-neighbor-changes
 network 1.0.2.0 mask 255.255.255.192
 network 1.0.2.128 mask 255.255.255.252
 network 1.0.2.132 mask 255.255.255.252
 network 1.0.2.192 mask 255.255.255.255
 network 2.0.0.0 mask 255.255.255.252
 neighbor 1.0.2.194 remote-as 200
 neighbor 1.0.2.194 update-source Loopback0
 neighbor 2.0.0.1 remote-as 100
 neighbor 2.0.0.1 default-originate
 neighbor 2.0.0.1 route-map DEFAULT out
 no auto-summary
!
ip route 0.0.0.0 0.0.0.0 Null0
!
ip prefix-list DEFAULT seq 5 permit 0.0.0.0/0
!
route-map DEFAULT permit 10
 match ip address prefix-list DEFAULT
</pre></div>
</div>
<p>R4:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>interface Loopback0
 ip address 1.0.2.194 255.255.255.255
!
interface FastEthernet0/0
 ip address 1.0.2.65 255.255.255.192
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 2.0.0.5 255.255.255.252
 clock rate 2000000
!
interface FastEthernet0/1
 ip address 1.0.2.138 255.255.255.252
 duplex auto
 speed auto
!
interface Serial0/1
 ip address 1.0.2.130 255.255.255.252
 clock rate 2000000
!
router ospf 10
 log-adjacency-changes
 redistribute bgp 200 subnets
 passive-interface FastEthernet0/0
 passive-interface Serial0/0
 passive-interface Loopback0
 network 1.0.2.64 0.0.0.63 area 0
 network 1.0.2.128 0.0.0.3 area 0
 network 1.0.2.136 0.0.0.3 area 0
 network 1.0.2.194 0.0.0.0 area 0
 network 2.0.0.4 0.0.0.3 area 0
!
router bgp 200
 no synchronization
 bgp log-neighbor-changes
 network 1.0.2.64 mask 255.255.255.192
 network 1.0.2.128 mask 255.255.255.252
 network 1.0.2.136 mask 255.255.255.252
 network 1.0.2.194 mask 255.255.255.255
 network 2.0.0.4 mask 255.255.255.252
 neighbor 1.0.2.192 remote-as 200
 neighbor 1.0.2.192 update-source Loopback0
 neighbor 2.0.0.6 remote-as 300
 neighbor 2.0.0.6 default-originate
 neighbor 2.0.0.6 route-map DEFAULT out
 no auto-summary
!
ip route 0.0.0.0 0.0.0.0 Null0 250
!
ip prefix-list DEFAULT seq 5 permit 0.0.0.0/0
!
route-map DEFAULT permit 10
 match ip address prefix-list DEFAULT
</pre></div>
</div>
<p>R5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>interface Loopback0
 ip address 1.0.3.192 255.255.255.255
!
interface FastEthernet0/0
 ip address 1.0.3.129 255.255.255.252
 duplex auto
 speed auto
!
interface Serial0/0
 ip address 2.0.0.6 255.255.255.252
 clock rate 2000000
!
router rip
 version 2
 redistribute bgp 300 metric 1
 passive-interface Serial0/0
 passive-interface Loopback0
 network 1.0.0.0
 network 2.0.0.0
 no auto-summary
!
router bgp 300
 no synchronization
 bgp log-neighbor-changes
 network 1.0.3.0 mask 255.255.255.0
 neighbor 2.0.0.5 remote-as 200
 no auto-summary
!
ip route 1.0.3.0 255.255.255.0 Null0 250
</pre></div>
</div>
</div>
</div>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://www.juniper.net/documentation/en_US/junos/topics/concept/bgp-routing-messages-overview.html">https://www.juniper.net/documentation/en_US/junos/topics/concept/bgp-routing-messages-overview.html</a></li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mpls.html" class="btn btn-neutral float-right" title="MPLS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="igrp.html" class="btn btn-neutral" title="IGRP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2019, Martín Bernardi.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>